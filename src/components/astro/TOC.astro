---
export interface Heading {
  depth: number;
  slug: string;
  text: string;
}

export interface Props {
  headings: Heading[];
}

const { headings } = Astro.props;

// Filter to only show h2 and h3
const filteredHeadings = headings.filter((h) => h.depth === 2 || h.depth === 3);
---

{filteredHeadings.length > 0 && (
  <nav class="sticky top-20 p-4 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700">
    <h2 class="text-lg font-bold mb-3 text-gray-900 dark:text-gray-100">목차</h2>
    <ul class="list-none m-0 p-0 space-y-2">
      {filteredHeadings.map((heading) => (
        <li class={`text-sm ${heading.depth === 3 ? 'ml-4' : 'ml-0'}`}>
          <a href={`#${heading.slug}`} class="toc-link text-gray-700 dark:text-gray-300 no-underline hover:text-blue-600 dark:hover:text-blue-400 hover:underline transition-colors">
            {heading.text}
          </a>
        </li>
      ))}
    </ul>
  </nav>
)}

<script>
  // Smooth scroll behavior
  document.querySelectorAll('.toc-link').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const targetId = link.getAttribute('href')?.slice(1);
      if (targetId) {
        const target = document.getElementById(targetId);
        target?.scrollIntoView({ behavior: 'smooth' });
      }
    });
  });
</script>
